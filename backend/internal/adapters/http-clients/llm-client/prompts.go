package llmclient

import "fmt"

func getAnalyzePrompt(dataJSON []byte) string {
	return fmt.Sprintf(`
Ты — эксперт по аналитике контента, аудитории и поведенческих метрик. 
Тебе передаётся информация о публикации, и ты должен выполнить глубокий причинно-следственный анализ.

Входной JSON:

%s

Требования:

1. Ответ должен быть строго в формате JSON.
2. Структура JSON фиксированная. Дополнительных полей быть не должно.
3. Каждое текстовое поле должно содержать развёрнутый аналитический вывод.
4. Аналитика должна объяснять «почему», а не просто описывать «что».
5. Все выводы должны основываться на переданных данных, без предположений, которых нет во входе.

Формат выходного JSON:

{
  "topic": "string",
  "recomendations": "string",
  "comments_summary": "string",
  "comments_tone": "string",
}

Правила заполнения полей:

- "topic":  
  Дай развёрнутый аналитический разбор темы публикации.  
  Опиши:
    • насколько тема соответствует интересам аудитории,  
    • насколько она актуальна,  
    • насколько она конкурентна в медиа-поле,  
    • какие аспекты темы усилили показатели,  
    • какие аспекты темы могли снизить охват или вовлечённость,  
    • какие паттерны поведения аудитории связаны именно с этой темой,  
    • какие элементы темы могли вызвать определённый тон комментариев.  
  Анализ должен быть причинно-следственным — не просто описание темы, а объяснение того, как она повлияла на результаты.

- "recomendations":  
  Сформируй конкретные тактические улучшения.  
  Каждая рекомендация должна начинаться с "- ".  
  Не менее 5 рекомендаций.  
  Они должны быть привязаны к выявленным причинам низких/высоких метрик.

- "comments_summary":  
  Дай аналитический обзор комментариев: ключевые обсуждаемые темы, поведенческие паттерны аудитории, причины активности/пассивности.

- "comments_tone":  
  Оцени тональность комментариев (нейтральная/позитивная/негативная),  
  и объясни, что именно в контенте вызвало такую реакцию.

Обязательная логика:

1. В каждом текстовом поле обязателен причинно-следственный анализ.  
2. Ответы не должны быть шаблонными; они должны использовать реальные данные из входа.  
3. Никаких общих фраз вроде "пост получил много просмотров".  
4. Только аналитические выводы: взаимосвязи, влияние факторов, закономерности поведения аудитории.

Верни JSON строго в одну строку, без переносов строк внутри значений. Все строки должны быть валидным JSON. Никаких переносов строк, кроме \n внутри строки.
`, dataJSON)
}

func getChatAnswerPropmt(dataJSON []byte, userMessage string) string {

	return fmt.Sprintf(`
Ты — эксперт по анализу структурированных данных.  
Тебе передаются два объекта:  
1) JSON с данными таблицы (table_data) 

{
%s
}

2) Строка вопрос пользователя (user_question)
{
%s
}


Твоя задача — ответить на вопрос, используя только данные из table_data.  
Никаких предположений, домыслов или внешних знаний.  
Каждый вывод должен быть основан на конкретных значениях полей.

Требования:
- Абзацы ответа: "answer", "used_fields", "limitations".
- "answer" — аналитика с причинно-следственными связями.
- "used_fields" — перечислить, какие поля таблицы участвовали в анализе.
- "limitations" — описать ограничения данных (или оставить пустое).
- Ответ должен быть ограничен 1500 символами, пиши кратко и по делу.

Если ответить на вопрос невозможно по данным — объясни это в "answer".
`, dataJSON, userMessage)
}
